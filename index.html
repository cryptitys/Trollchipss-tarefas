<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarefa SP</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fontes Inter e Font Awesome para ícones -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
      <style>
        /* Variáveis CSS combinadas - priorizando o conjunto mais abrangente do expansao.php */
        :root {
  /* --- Cores principais --- */
  --primary: #1e90ff; /* Azul principal */
  --primary-dark: #1c86ee; /* Azul mais escuro */
  --primary-light: #63b3ff; /* Azul claro */
  --primary-ultra-light: #cce4ff; /* Azul bem clarinho */

  /* --- Cores secundárias e fundo --- */
  --secondary: #0d0d0d; /* Mantém contraste escuro para elementos secundários */
  --secondary-light: #1a1a1a;
  --background: #001f3f; /* Fundo azul escuro */
  --background-light: #003366; /* Fundo azul um pouco mais claro */

  /* --- Cards e interações --- */
  --card: #00264d; /* Azul escuro para cartões */
  --card-hover: #003366; /* Hover azul */
  
  /* --- Textos --- */
  --text-primary: #f0f0f0; /* Branco para contraste */
  --text-secondary: #b0b0b0;
  --text-muted: #808080;

  /* --- Feedback --- */
  --success: #48bb78; /* Verde */
  --error: #f56565;   /* Vermelho */
  --warning: #ed8936; /* Laranja */

  /* --- Bordas e sombras --- */
  --border: #333333;
  --border-light: rgba(255, 255, 255, 0.1);
  --shadow: rgba(0, 0, 0, 0.5);
  --shadow-lg: rgba(0, 0, 0, 0.7);

  /* --- Efeitos de brilho --- */
  --glow: rgba(30, 144, 255, 0.5); /* Azul glow */
  --glow-intense: rgba(30, 144, 255, 1);
  --pulse-glow: rgba(30, 144, 255, 0.8);

  /* --- Efeito glassmorphism --- */
  --glass-bg: rgba(0, 38, 77, 0.05); /* Transparência azulada */
  --glass-border: rgba(255, 255, 255, 0.08);

  /* --- Discord-style (opcional) --- */
  --discord-gray: #2C2F33;
  --discord-dark-gray: #23272A;
        }
            /* Imagem de fundo personalizada do expansao.php */
            --custom-background-image: url('https://trollchipss.netlify.app/logo-trollchips.png');
            --custom-background-position: center;
            --custom-background-size: cover;
            --custom-background-repeat: no-repeat;
        }

        /* Estilos globais e de barra de rolagem do expansao.php */
        html {
            scroll-behavior: smooth;
            scrollbar-width: none;
            height: 100%;
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        ::-webkit-scrollbar {
            display: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-image: var(--custom-background-image);
            background-position: var(--custom-background-position);
            background-size: var(--custom-background-size);
            background-repeat: var(--custom-background-repeat);
            background-attachment: fixed;
            background-color: transparent; /* Fundo transparente */
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px 20px; /* MODIFICAÇÃO: Ajuste no padding para o header */
            position: relative;
            font-weight: 400;
        }

        /* MODIFICAÇÃO: Header Fixo */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: rgba(28, 28, 28, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 0 20px;
            z-index: 1010;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Alterado de flex-end para flex-start */
        }

        .header-back-button {
            background-color: transparent;
            border: 1px solid var(--primary-light);
            color: var(--primary-light);
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .header-back-button:hover {
            background-color: var(--primary);
            color: white;
        }


        /* Preloader do expansao.php */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: var(--custom-background-image);
            background-position: var(--custom-background-position);
            background-size: var(--custom-background-size);
            background-repeat: var(--custom-background-repeat);
            background-color: var(--background);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.6s ease-out;
        }
        .loader {
            width: 60px;
            height: 60px;
            border: 3px solid transparent;
            border-top: 3px solid var(--primary-light);
            border-right: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
            filter: drop-shadow(0 0 20px var(--glow));
        }
        .loader::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 2px solid var(--primary-ultra-light);
            border-radius: 50%;
            animation: spin 1.5s linear infinite reverse;
        }
        .loading-text {
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Container de partículas do expansao.php */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Behind content */
            pointer-events: none;
        }
        .particle {
            position: absolute;
            background-color: var(--primary-light);
            border-radius: 50%;
            opacity: 0;
            box-shadow: 0 0 6px var(--primary-light), 0 0 12px var(--primary-light);
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.4; }
            100% { transform: translateY(105vh) rotate(360deg); opacity: 0; }
        }

        /* Overlay de carregamento do tarefas.php (para carregamento dentro do aplicativo) */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 1.2rem;
            text-align: center;
            backdrop-filter: blur(5px);
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        #loadingOverlay.visible {
            opacity: 1;
            pointer-events: all;
        }
        #loadingOverlay img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            border-radius: 50%;
        }
        #loadingOverlay .loading-title { /* NOVO: Título dinâmico */
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 0.5rem;
        }
        #loadingOverlay .loading-message { /* NOVO: Mensagem dinâmica */
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        .main-layout.blurred-content {
            filter: blur(5px);
            transition: filter 0.3s ease-in-out;
        }

        /* Layout principal do tarefas.php - Removido sidebar e header */
        .main-layout {
            display: flex;
            flex-direction: column;
            width: 100%;
            min-height: 100vh; /* Ajustado para min-height para permitir rolagem */
            background-color: transparent; /* Fundo transparente */
            animation: fadeIn 0.5s ease-out;
            position: relative;
            padding: 20px; /* Adicionado padding para o conteúdo principal */
            box-sizing: border-box;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilos específicos da Tarefa SP do tarefas.php */
        .tarefasp-page-content {
            padding: 0; /* Removido padding para usar o do main-layout */
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 40vh; /* Mantido para espaçamento inferior */
        }
        .tarefasp-header {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        .tarefasp-header h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .tarefasp-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            align-items: center;
        }
        .tarefasp-filters > div {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            position: relative;
        }
        .tarefasp-filters button {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 0.75rem 1.25rem;
            color: var(--text-primary);
            font-weight: 500;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            cursor: pointer;
        }
        /* Botões de filtro não devem ficar transparentes */
        .tarefasp-filters button:hover {
            background-color: var(--primary-dark); /* Cor sólida no hover */
            border-color: var(--primary-light);
        }
        .tarefasp-filters button.active {
            background-color: var(--primary-dark);
            color: white;
            border-color: var(--primary);
        }
        
        /* MODIFICAÇÃO: Estilo destacado para o botão "Processar todas as tarefas" */
        #processAllTasksButton {
            background-color: var(--primary) !important;
            color: white !important;
            border-color: var(--primary) !important;
        }
        #processAllTasksButton:hover {
            background-color: var(--primary-dark) !important;
        }

        /* Dropdown de filtro de status do tarefas.php */
        .status-filter-dropdown {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            background-color: var(--background-light);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            min-width: 150px;
            padding: 0.5rem;
            display: none;
            flex-direction: column;
            gap: 0.25rem;
        }
        .status-filter-dropdown.open {
            display: flex;
        }
        .status-filter-dropdown button {
            width: 100%;
            text-align: left;
            background: none;
            border: none;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-weight: 400;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-radius: 0.5rem;
        }
        .status-filter-dropdown button:hover {
            background-color: var(--primary-dark); /* Cor sólida no hover */
            color: var(--primary-light);
        }
        .status-filter-dropdown button.selected {
            background-color: var(--primary-dark);
            color: white;
            font-weight: 600;
        }

        /* Cartão de tarefa do tarefas.php */
        .task-card-container {
            position: relative;
            height: 180px;
            width: 100%;
        }
        .task-card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--card);
            border-radius: 1rem;
            padding: 1rem;
            border: 1px solid var(--border);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            transition: all 0.3s ease-in-out;
            overflow: hidden;
            z-index: 1;
        }
        .task-card.expandido {
            height: auto;
            max-height: 400px;
            z-index: 10;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        .task-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .task-card-subject {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary-light);
            text-transform: uppercase;
        }
        .task-card-status {
            background-color: rgba(138, 43, 226, 0.2); /* Ajustado rgba */
            border-radius: 0.5rem;
            padding: 0.1rem 0.5rem;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--primary-light);
            text-transform: uppercase;
        }
        .task-card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .task-card.expandido .task-card-title {
            white-space: normal;
            overflow: visible;
            text-overflow: clip;
        }
        .task-card-details-on-hover {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.3s ease-out, margin-top 0.4s ease-out, padding-top 0.4s ease-out;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .task-card.expandido .task-card-details-on-hover {
            max-height: 250px;
            opacity: 1;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }
        .task-proceed-button {
            width: 100%;
            text-align: center;
            background-color: transparent;
            border: 1px solid var(--primary-light);
            color: var(--primary-light);
            padding: 0.6rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            opacity: 0;
            max-height: 0;
            margin-top: 0;
            overflow: hidden;
            transition: background-color 0.2s ease, color 0.2s ease, opacity 0.3s ease-out, max-height 0.4s ease-out, margin-top 0.4s ease-out;
        }
        .task-card.expandido .task-proceed-button {
            opacity: 1;
            max-height: 100px;
            margin-top: 1rem;
        }
        .task-proceed-button:hover {
            background-color: var(--primary-dark);
            color: white;
        }
        .task-proceed-button:disabled {
            cursor: not-allowed;
            opacity: 0.5 !important;
            background-color: var(--card) !important;
            color: var(--text-muted) !important;
            border-color: var(--border) !important;
        }
        .task-card-dates {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        .task-card-days-remaining {
            font-weight: 600;
        }
        .task-card-progress-bar-container {
            flex-grow: 1;
            margin: 0 0.5rem;
            min-width: 60px;
        }
        .task-card-progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .task-card-progress-bar-fill {
            background-color: var(--primary);
            border-radius: 3px;
            height: 100%;
        }
        
        /* MODIFICAÇÃO: Ajuste no container de tarefas para alinhar com os filtros */
        #tasksContent {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            grid-auto-rows: min-content;
            align-items: start;
            position: relative;
            min-height: 500px;
            /* padding: 20px; */ /* Removido para alinhar com os filtros */
            /* Adicionado para criar um espaço à direita, fazendo o container ocupar 80% da largura */
            width: 80%;
        }

        /* MODIFICAÇÃO: Estilos para tarefa em processamento */
        .task-card.processing {
            border-color: var(--warning);
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0% {
                box-shadow: 0 0 0 0 rgba(237, 137, 54, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(237, 137, 54, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(237, 137, 54, 0);
            }
        }

        .task-card.processing .task-proceed-button {
            background-color: var(--card) !important;
            color: var(--warning) !important;
            border-color: var(--warning) !important;
            cursor: not-allowed;
        }

        /* Modal de tarefa entregue do tarefas.php */
        .delivered-task-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            backdrop-filter: blur(8px); /* Aplicar blur ao fundo do modal */
        }
        .delivered-task-modal.open {
            opacity: 1;
            visibility: visible;
        }
        .delivered-task-modal-content {
            background-color: rgba(28, 28, 28, 0.9); /* Leve transparência */
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            color: var(--text-primary);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            margin-left: auto;
            margin-right: auto;
        }
        .delivered-task-modal.open .delivered-task-modal-content {
            transform: translateY(0);
        }
        .modal-scrollable-area {
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 1.5rem;
            padding-right: 0.5rem;
        }
        .delivered-task-modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 1rem;
        }
        .delivered-task-modal-content p {
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
        .delivered-task-modal-content p strong {
            color: var(--text-primary);
        }
        .delivered-task-modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            flex-shrink: 0;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        .delivered-task-modal-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        .delivered-task-modal-buttons .close-modal-button {
            background-color: var(--card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        .delivered-task-modal-buttons .close-modal-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        .delivered-task-modal-buttons .view-response-button {
            background-color: var(--primary);
            border: 1px solid var(--primary);
            color: white;
        }
        .delivered-task-modal-buttons .view-response-button:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        /* NOVO: Modal de Processamento de Tarefa */
        .task-processing-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Fundo semi-transparente */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            backdrop-filter: blur(8px); /* Efeito de blur no fundo */
        }
        .task-processing-modal.open {
            opacity: 1;
            visibility: visible;
        }
        .task-processing-modal-content {
            background-color: rgba(28, 28, 28, 0.9); /* Leve transparência */
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            color: var(--text-primary);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            margin-left: auto;
            margin-right: auto;
        }
        .task-processing-modal.open .task-processing-modal-content {
            transform: translateY(0);
        }
        .task-processing-modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 1rem;
            text-align: center;
        }
        .task-processing-modal-content .input-group {
            margin-bottom: 1rem;
        }
        .task-processing-modal-content label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        .task-processing-modal-content input {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--background-light);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 1rem;
        }
        .task-processing-modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }
        .task-processing-modal-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        .task-processing-modal-buttons .save-draft-button {
            background-color: var(--card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        .task-processing-modal-buttons .save-draft-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        .task-processing-modal-buttons .do-task-button {
            background-color: var(--primary);
            border: 1px solid var(--primary);
            color: white;
        }
        .task-processing-modal-buttons .do-task-button:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        /* NOVO: Estilos para o Modal de Processamento em Lote */
        .batch-processing-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1003; /* Maior que outros modais */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            backdrop-filter: blur(8px);
        }
        .batch-processing-modal.open {
            opacity: 1;
            visibility: visible;
        }
        .batch-processing-modal-content {
            background-color: rgba(28, 28, 28, 0.9);
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 600px; /* Um pouco maior para a lista de tarefas */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            color: var(--text-primary);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            margin-left: auto;
            margin-right: auto;
        }
        .batch-processing-modal.open .batch-processing-modal-content {
            transform: translateY(0);
        }
        .batch-processing-modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 1rem;
            text-align: center;
        }
        .batch-processing-modal-content .input-group {
            margin-bottom: 1rem;
        }
        .batch-processing-modal-content label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        .batch-processing-modal-content input[type="number"] {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--background-light);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 1rem;
        }
        .batch-tasks-list {
            max-height: 300px; /* Altura fixa para a lista de tarefas */
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            margin-bottom: 1rem;
            background-color: var(--background-light);
        }
        .batch-task-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.5rem 0;
            border-bottom: 1px dashed var(--border-light);
        }
        .batch-task-item:last-child {
            border-bottom: none;
        }
        .batch-task-item input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
            transform: scale(1.2); /* Aumenta o tamanho do checkbox */
        }
        .batch-task-item .task-name {
            flex-grow: 1;
            font-size: 0.95rem;
            color: var(--text-primary);
        }
        .batch-task-item .draft-option {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            gap: 5px;
        }

        /* NOVO: Estilos para os badges de status no modal de lote */
        .batch-task-item .status-badge {
            display: inline-block;
            padding: 0.1rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 8px;
        }

        .batch-task-item .status-badge.pending {
            background-color: rgba(138, 43, 226, 0.2); /* primary-light */
            color: var(--primary-light);
        }

        .batch-task-item .status-badge.expired {
            background-color: rgba(245, 101, 101, 0.2); /* error */
            color: var(--error);
        }

        .batch-task-item .status-badge.draft {
            background-color: rgba(237, 137, 54, 0.2); /* warning */
            color: var(--warning);
        }

        .batch-task-item .status-badge.processing {
            background-color: rgba(255, 255, 0, 0.2); /* Amarelo para processando */
            color: yellow;
        }

        /* Estilo para o item da tarefa quando está em processamento */
        .batch-task-item .task-item-content.processing-task {
            opacity: 0.7;
            pointer-events: none; /* Desabilita interação */
        }

        /* Estilos para as estatísticas do lote */
        .batch-stats {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .batch-stats strong {
            color: var(--text-primary);
        }


        .batch-processing-modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }
        .batch-processing-modal-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        .batch-processing-modal-buttons .cancel-button {
            background-color: var(--card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        .batch-processing-modal-buttons .cancel-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        .batch-processing-modal-buttons .process-button {
            background-color: var(--primary);
            border: 1px solid var(--primary);
            color: white;
        }
        .batch-processing-modal-buttons .process-button:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }


        /* Modal de Login do expansao.php (Estilos copiados para consistência) */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.5);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.4s ease forwards;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background-color: var(--card);
            padding: 40px;
            border-radius: 24px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--border);
            box-shadow: 0 25px 70px rgba(138, 43, 226, 0.7);
            animation: scaleIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            display: flex;
            flex-direction: column;
            position: relative;
            isolation: isolate;
            box-sizing: border-box;
        }
        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 24px;
            border: 2px solid transparent;
            background: linear-gradient(45deg, var(--primary-light), var(--primary)) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            opacity: 0.1;
        }
        .modal h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            background-image:
                linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.9) 50%, transparent 100%),
                linear-gradient(to right, var(--primary-dark) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 100%, 100% 100%;
            background-position: -200% 0, 0 0;
            animation: shimmer 2.5s infinite linear;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0, 0 0; }
            100% { background-position: 200% 0, 0 0; }
        }
        /* Específico do modal de login para corresponder ao expansao.php */
        #loginModal .modal-content {
            background: rgba(0, 0, 0, 0.75);
            border-radius: 24px !important;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 450px;
            padding: 40px;
            backdrop-filter: blur(8px);
            animation: scaleIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        #loginModal .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        #loginModal .login-header h2 {
            font-size: 2.5rem;
            margin-top: 10px;
            margin-bottom: 10px;
            font-weight: 800;
            background-image:
                linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.9) 50%, transparent 100%),
                linear-gradient(to right, var(--primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% 100%, 100% 100%;
            background-position: -200% 0, 0 0;
            animation: shimmer-login 4s linear infinite;
        }
        @keyframes shimmer-login {
            0% { background-position: -200% 0, 0 0; }
            100% { background-position: 200% 0, 0 0; }
        }
        #loginModal .login-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        #loginModal .input-group {
            margin-bottom: 25px;
            position: relative;
        }
        #loginModal .input-group input {
            width: 100%;
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: 0.3s;
        }
        #loginModal .input-group input[type="password"] {
             padding-right: 45px;
        }
        #loginModal .input-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px var(--glow);
            transform: none;
        }
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s ease;
            z-index: 10;
            font-size: 1.1rem;
        }
        .password-toggle:hover {
            color: var(--primary);
        }
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-top: 24px;
        }
        button {
            padding: 18px 26px;
            border: none;
            border-radius: 8px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-family: inherit;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }
        /* MODIFICAÇÃO: Estilos aprimorados para os botões do modal de login */
        #loginModal .button-group button {
            padding: 16px 24px;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 6px 25px var(--glow);
        }
        .btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 35px var(--pulse-glow);
        }
        .btn-discord {
            background-color: var(--discord-gray);
            color: white;
            box-shadow: 0 6px 25px rgba(44, 47, 51, 0.5);
        }
        .btn-discord:hover {
            background-color: var(--discord-dark-gray);
            transform: translateY(-4px);
            box-shadow: 0 10px 35px rgba(35, 39, 42, 0.7);
        }
        
        /* Modal de Respostas */
        .answers-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1003;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            backdrop-filter: blur(8px); /* Aplicar blur ao fundo do modal */
        }
        .answers-modal.open {
            opacity: 1;
            visibility: visible;
        }
        .answers-modal-content {
            background-color: rgba(28, 28, 28, 0.9); /* Leve transparência */
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            color: var(--text-primary);
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            margin-left: auto;
            margin-right: auto;
        }
        .answers-modal.open .answers-modal-content {
            transform: translateY(0);
        }
        .answers-modal-content h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
            margin-bottom: 1.5rem;
        }
        .answers-modal-content .question-block {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .answers-modal-content .question-block h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        .answers-modal-content .question-block p {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }
        .answers-modal-content .question-block .correct-answer {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px dashed var(--border-light);
            font-weight: 500;
            color: var(--success);
        }
        .answers-modal-content .question-block .correct-answer strong {
            color: var(--success);
        }
        .answers-modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            flex-shrink: 0;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        .answers-modal-buttons button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        .answers-modal-buttons .close-modal-button {
            background-color: var(--card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }
        .answers-modal-buttons .close-modal-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        .answers-modal-scrollable-area {
            overflow-y: auto;
            flex-grow: 1;
            margin-bottom: 1.5rem;
            padding-right: 0.5rem;
        }


        /* NOVO: Estilos para as notificações */
        .notification-container {
            position: fixed;
            top: 80px; /* Abaixo do header */
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none; /* Permite cliques através do container */
        }

        .notification-item {
            background-color: var(--card);
            color: var(--text-primary);
            padding: 15px 20px;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            min-width: 250px;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 10px;
            pointer-events: all; /* Permite interação com a notificação */
        }

        .notification-item.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification-item.hide {
            opacity: 0;
            transform: translateX(100%);
        }

        .notification-item.info {
            border-left: 5px solid var(--primary-light);
        }

        .notification-item.warning {
            border-left: 5px solid var(--warning);
        }

        .notification-item.success {
            border-left: 5px solid var(--success);
        }

        .notification-item.error {
            border-left: 5px solid var(--error);
        }

        .notification-item .icon {
            font-size: 1.2rem;
        }

        .notification-item .message {
            flex-grow: 1;
            font-size: 0.95rem;
        }

        /* Ajustes responsivos */
        @media (max-width: 1024px) { /* Em telas de tablet, mostrar 2 colunas */
            #tasksContent {
                grid-template-columns: repeat(2, 1fr);
                width: 100%; /* Ocupa a largura total em telas menores */
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 70px 10px 10px; /* Ajusta o padding do body para mobile */
            }
            .main-layout {
                padding: 10px; /* Ajusta o padding do main-layout para mobile */
            }
            .tarefasp-page-content {
                padding: 0;
                padding-bottom: 40vh;
            }
            .task-card {
                padding: 0.75rem;
                gap: 0.4rem;
            }
            .task-card-subject, .task-card-status, .task-card-dates {
                font-size: 0.7rem;
            }
            .task-card-title {
                font-size: 0.9rem;
            }
            .task-card.expandido {
                margin-top: 0;
            }
            .delivered-task-modal-content, .answers-modal-content, .task-processing-modal-content, .batch-processing-modal-content {
                width: 95%;
                max-width: none;
                padding: 1.5rem;
            }
            .tarefasp-filters {
                padding: 0;
            }
            #loginModal .modal-content {
                padding: 20px;
            }
            #loginModal .login-header h2 {
                font-size: 2rem;
            }
            #tasksContent {
                grid-template-columns: repeat(2, 1fr); /* 2 colunas em tablets */
            }
        }
        @media (max-width: 480px) {
            #tasksContent {
                grid-template-columns: 1fr; /* Coluna única em telas muito pequenas */
                padding: 10px;
            }
            .tarefasp-filters {
                flex-direction: column; /* Empilha os filtros verticalmente */
                align-items: stretch;
            }
            .tarefasp-filters > div {
                width: 100%;
            }
            .tarefasp-filters button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <a href="#" class="header-back-button">
           <i class="fas fa-arrow-left"></i>&nbsp;Voltar
       </a>
   </header>
    <!-- Preloader do expansao.php -->
    <div id="preloader">
        <div class="loader"></div>
        <div class="loading-text">Carregando...</div>
    </div>

    <!-- Container de partículas do expansao.php -->
    <div id="particle-container"></div>

    <!-- Overlay de carregamento do tarefas.php (para carregamento dentro do aplicativo) -->
    <div id="loadingOverlay" class="flex flex-col items-center justify-center">
        <img src="https://trollchipss.netlify.app/logo-trollchips.png" alt="Logo" class="mb-5 rounded-full">
        <p class="loading-title">Carregando...</p> <!-- Título dinâmico -->
        <p class="loading-message">Sincronizando dados.</p> <!-- Mensagem dinâmica -->
    </div>

    <!-- Modal de Login Inicial (do expansao.php, ativo por padrão) -->
    <div class="modal active" id="loginModal">
        <div class="modal-content">
            <div class="login-header">
                <i class="fas fa-moon" style="font-size: 50px; margin-bottom: 15px; color: var(--primary-light);"></i>
                <h2>TROLLCHIPS 》《 TarefaS</h2>
                <p>Log in with your credentials .</p>
            </div>

            <form id="authForm">
                <div class="input-group">
                    <input type="text" id="ra" name="ra" required placeholder="Seu Registro de Aluno (RA)">
                </div> 
                <div class="input-group">
                    <div style="position: relative; width: 100%;">
                        <input type="password" id="password" name="password" required placeholder="Sua senha">
                        <i class="password-toggle fas fa-eye" id="togglePasswordLogin"></i>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="submit-btn btn-primary">Entrar</button>
                    <button type="button" class="discord-btn btn-discord" onclick="window.open('https://trollchipss.netlify.app)">
                         </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para tarefas entregues (do tarefas.php) -->
    <div id="deliveredTaskModal" class="delivered-task-modal">
        <div class="delivered-task-modal-content">
            <div class="modal-scrollable-area">
                <h3 id="modalSubjectTitle"></h3>
                <p><strong>Título da Tarefa:</strong> <span id="modalTaskTitle"></span></p>
                <p><strong>Nota:</strong> <span id="modalTaskScore"></span></p>
                <p><strong>ID da Tarefa:</strong> <span id="modalTaskId"></span></p>
            </div>
            <div class="delivered-task-modal-buttons">
                <button id="closeDeliveredTaskModal" class="close-modal-button">Fechar</button>
                <button id="viewResponseButton" class="view-response-button">Visualizar Resposta</button>
            </div>
        </div>
    </div>

    <!-- NOVO: Modal de Processamento de Tarefa (Individual) -->
    <div id="taskProcessingModal" class="task-processing-modal">
        <div class="task-processing-modal-content">
            <h3 id="processingModalTitle" class="text-center">Processando Tarefa</h3>
            <div id="processingTaskDetails" class="mb-4 p-4 rounded-lg bg-gray-800 border border-gray-700">
                <div class="flex justify-between items-center mb-2">
                    <p id="modalProcessingSubject" class="task-card-subject"></p>
                    <span id="modalProcessingStatus" class="task-card-status"></span>
                </div>
                <p id="modalProcessingTitle" class="task-card-title text-lg mb-2"></p>
                <div class="text-xs space-y-1">
                    <p id="modalProcessingDescription" class="mb-2 text-gray-400"></p>
                    <hr class="border-gray-700 my-2">
                    <p><b>ID da tarefa:</b> <span id="modalProcessingTaskId"></span></p>
                    <p><b>Primeiro Acesso:</b> <span id="modalProcessingFirstAccess"></span></p>
                </div>
            </div>

            <div class="input-group">
                <label for="minTime">Tempo mín. (minutos):</label>
                <input type="number" id="minTime" placeholder="Ex: 30" min="0">
            </div>
            <div class="input-group">
                <label for="maxTime">Tempo máx. (minutos):</label>
                <input type="number" id="maxTime" placeholder="Ex: 60" min="0">
            </div>
            <div class="task-processing-modal-buttons">
                <button id="saveDraftButton" class="save-draft-button">Salvar como rascunho</button>
                <button id="doTaskButton" class="do-task-button">Fazer tarefa</button>
            </div>
        </div>
    </div>

    <!-- MODIFICAÇÃO: Modal de Processamento em Lote com novos botões -->
    <div id="batchProcessingModal" class="batch-processing-modal">
        <div class="batch-processing-modal-content">
            <h3 class="text-center">Processar Tarefas em Lote</h3>
            <div class="input-group">
                <label for="batchMinTime">Tempo mín. (minutos):</label>
                <input type="number" id="batchMinTime" placeholder="Ex: 30" min="0">
            </div>
            <div class="input-group">
                <label for="batchMaxTime">Tempo máx. (minutos):</label>
                <input type="number" id="batchMaxTime" placeholder="Ex: 60" min="0">
            </div>
            
            <!-- Controles de seleção em lote -->
            <div class="flex items-center justify-start gap-2 mb-2">
                <button id="batchSelectAll" class="text-xs bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded-md transition-colors">Selecionar Todas</button>
                <button id="batchSelectAllDraft" class="text-xs bg-green-600 hover:bg-green-700 text-white font-semibold py-1 px-3 rounded-md transition-colors">Todas como Rascunho</button>
                <button id="batchDeselectAll" class="text-xs bg-gray-600 hover:bg-gray-700 text-white font-semibold py-1 px-3 rounded-md transition-colors">Limpar Seleção</button>
            </div>

            <div class="batch-tasks-list" id="batchTasksList">
                <!-- As tarefas serão carregadas aqui -->
                <p class="text-gray-500 text-center">Nenhuma tarefa pendente encontrada.</p>
            </div>

            <div class="batch-processing-modal-buttons">
                <button id="closeBatchProcessingModal" class="cancel-button">Cancelar</button>
                <button id="processSelectedTasksButton" class="process-button">Processar Tarefas Selecionadas</button>
            </div>
        </div>
    </div>

    <!-- NOVO: Modal para exibir respostas das tarefas -->
    <div id="answersModal" class="answers-modal">
        <div class="answers-modal-content">
            <h3>Respostas da Tarefa</h3>
            <div id="answersContent" class="answers-modal-scrollable-area">
                <!-- As respostas serão carregadas aqui -->
            </div>
            <div class="answers-modal-buttons">
                <button id="closeAnswersModal" class="close-modal-button">Fechar</button>
            </div>
        </div>
    </div>

    <!-- NOVO: Container para notificações -->
    <div id="notificationContainer" class="notification-container"></div>


    <!-- Layout Principal do Dashboard (do tarefas.php, oculto inicialmente) -->
    <div class="main-layout hidden" id="mainSection">
        <!-- Removida a sidebar e o header completamente -->
        <main class="tarefasp-page-content">
            <!-- Ícone e Título Tarefa SP -->
            <div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-hpjul1 flex items-center gap-4 mb-6">
                <svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-13mjey1" focusable="false" aria-hidden="true" viewBox="0 0 57 64" data-testid="TarefaSPIcon" width="57" height="64" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-14 h-16">
                    <title>Tarefa SP</title>
                    <mask id="path-1-inside-1_14741_59229" fill="white">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.0922 0.702148C6.32782 0.702148 0.844238 6.18573 0.844238 12.9501V44.5156C0.844238 51.28 6.32782 56.7636 13.0922 56.7636H23.1812C23.228 56.8653 23.2801 56.9663 23.3378 57.0662L25.8444 61.4078C27.1913 63.7407 30.5586 63.7407 31.9055 61.4078L34.4121 57.0662C34.4698 56.9663 34.5219 56.8653 34.5687 56.7636H44.6577C51.4221 56.7636 56.9056 51.28 56.9056 44.5156V12.9501C56.9056 6.18573 51.4221 0.702148 44.6577 0.702148H13.0922Z"></path>
                    </mask>
                    <path d="M23.1812 56.7636L26.269 55.3459L25.36 53.3659H23.1812V56.7636ZM23.3378 57.0662L26.2802 55.3674L26.2802 55.3674L23.3378 57.0662ZM25.8444 61.4078L28.7868 59.709L25.8444 61.4078ZM31.9055 61.4078L34.848 63.1066L31.9055 61.4078ZM34.4121 57.0662L31.4697 55.3674L31.4697 55.3674L34.4121 56.7636ZM34.5687 56.7636V53.3659H32.39L31.4809 55.3459L34.5687 56.7636ZM4.2419 12.9501C4.2419 8.0622 8.20429 4.09981 13.0922 4.09981V-2.69551C4.45134 -2.69551 -2.55342 4.30925 -2.55342 12.9501H4.2419ZM4.2419 44.5156V12.9501H-2.55342V44.5156H4.2419ZM13.0922 53.3659C8.20429 53.3659 4.2419 49.4035 4.2419 44.5156H-2.55342C-2.55342 53.1565 4.45134 60.1612 13.0922 60.1612V53.3659ZM23.1812 53.3659H13.0922V60.1612H23.1812V53.3659ZM26.2802 55.3674C26.2751 55.3585 26.2715 55.3513 26.269 55.3459L20.0935 58.1812C20.1844 58.3793 20.2851 58.5741 20.3953 58.7651L26.2802 55.3674ZM28.7868 59.709L26.2802 55.3674L20.3953 58.765L22.9019 63.1066L28.7868 59.709ZM28.9631 59.709C28.949 59.7334 28.9395 59.7427 28.9379 59.7443C28.9357 59.7464 28.9345 59.7473 28.9326 59.7483C28.927 59.7514 28.9072 59.7598 28.875 59.7598C28.8427 59.7598 28.8229 59.7514 28.8174 59.7483C28.8154 59.7473 28.8142 59.7464 28.8121 59.7443C28.8104 59.7427 28.8009 59.7334 28.7868 59.709L22.9019 63.1066C25.5566 67.7047 32.1933 67.7047 34.848 63.1066L28.9631 59.709ZM31.4697 55.3674L28.9631 59.709L34.848 63.1066L37.3546 58.765L31.4697 55.3674ZM31.4809 55.3459C31.4784 55.3513 31.4748 55.3585 31.4697 55.3674L37.3546 58.7651C37.4648 58.5741 37.5655 58.3793 37.6564 58.1812L31.4809 55.3459ZM44.6577 53.3659H34.5687V60.1612H44.6577V53.3659ZM53.508 44.5156C53.508 49.4035 49.5456 53.3659 53.508 44.5156H60.3033C60.3033 53.1565 53.2985 60.1612 44.6577 60.1612V53.3659ZM53.508 12.9501V44.5156H60.3033V12.9501H53.508ZM44.6577 4.09981C49.5456 4.09981 53.508 8.0622 53.508 12.9501H60.3033C60.3033 4.30925 53.2985 -2.69551 44.6577 -2.69551V4.09981Z" fill="#162F67" mask="url(#path-1-inside-1_14741_59229)"></path>
                    <rect x="11.8868" y="11.7442" width="34.2108" height="34.2108" rx="5.49962" stroke="#162F67" stroke-width="3.39766"></rect>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M40.5156 21.0031C40.847 21.3346 41.0332 21.7842 41.0332 22.2529C41.0332 22.7217 40.847 23.1713 40.5156 23.5028L27.2649 36.7535C27.0898 36.9286 26.8819 37.0676 26.6531 37.1624C26.4243 37.2571 26.179 37.3059 25.9314 37.3059C25.6837 37.3059 25.4384 37.2571 25.2096 37.1624C24.9808 37.0676 24.7729 36.9286 24.5978 36.7535L18.0143 30.1712C17.8455 30.0081 17.7108 29.813 17.6181 29.5973C17.5255 29.3816 17.4767 29.1497 17.4747 28.9149C17.4726 28.6802 17.5174 28.4474 17.6063 28.2301C17.6951 28.0129 17.8264 27.8155 17.9924 27.6495C18.1584 27.4835 18.3558 27.3522 18.573 27.2633C18.7903 27.1745 19.0231 27.1297 19.2578 27.1318C19.4926 27.1338 19.7245 27.1826 19.9402 27.2752C20.1559 27.3679 20.351 27.5026 20.5141 27.6714L25.9308 33.0881L38.0147 21.0031C38.1788 20.8388 38.3738 20.7085 38.5883 20.6195C38.8029 20.5306 39.0329 20.4849 39.2651 20.4849C39.4974 20.4849 39.7274 20.5306 39.9419 20.6195C40.1565 20.7085 40.3514 20.8388 40.5156 21.0031Z" fill="#26A95E"></path>
                </svg>
                <h5 class="MuiTypography-root MuiTypography-h5 text-xl font-semibold text-white" data-testid="tarefa-sp">Tarefa SP</h5>
            </div>

            <!-- Conteúdo da Página de Tarefa SP -->
            <div class="tarefasp-header">
                <h2>Tarefa SP</h2>
                <p class="text-sm text-gray-400 mt-1">
                    <a href="dashboard" class="hover:underline">Home</a> / Tarefa SP
                </p>
            </div>

            <!-- Filtros -->
            <div class="tarefasp-filters">
                <div class="relative">
                    <label>Turmas:</label>
                    <button id="allClassesButton" class="rounded-xl">Todas as turmas</button>
                </div>
                <div class="relative">
                    <label>Status:</label>
                    <button id="toDoButton" class="rounded-xl">A fazer</button>
                    <div id="statusFilterDropdown" class="status-filter-dropdown">
                        <button id="filterToDo" class="selected">A fazer</button>
                        <button id="filterDelivered">Entregues</button>
                        <button id="filterExpired">Expiradas</button>
                    </div>
                </div>
                <!-- Removido o botão "Componentes" e "Todos os Componentes" -->
                <div class="relative">
                    <label>&nbsp;</label> <!-- Espaço para alinhar com os outros labels -->
                    <button id="processAllTasksButton" class="rounded-xl">Processar todas as tarefas</button>
                </div>
            </div>

            <div id="tasksContent">
                <!-- As tarefas serão carregadas aqui pelo JavaScript -->
                <p id="noTasks" class="text-gray-400 text-center col-span-full">Nenhuma tarefa encontrada.</p>
            </div>
        </main>
    </div>
 
     <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"687c29d3bd0e49a7ac31e660289d8d92","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
         <div id="modal-container"></div>
        <div id="toast-container" class="toast-container"></div>
          <script
    src="https://js.sentry-cdn.com/8d38ce047555b74bc9ae8c98ff73bb3c.min.js"
    crossorigin="anonymous"
    ></script>
    <script
        async
        defer
        src="https://cdn.jsdelivr.net/gh/altcha-org/altcha/dist_i18n/pt-br.min.js"
        type="module"
    >
    </script>
    <script
        async
        defer
        src="https://cdn.jsdelivr.net/npm/altcha@latest/dist/altcha.min.js"
        type="module"
    ></script>
    <div class="overlay" id="sidebarOverlay"></div>

                                    
<script>
// Configurações da API
const PYTHON_SERVER_URL = 'https://sala-futuro-backend.onrender.com'; // URL do seu backend no Render

// Mapeamento de categorias de tarefas
const categoryMap = {
    1: 'Língua Portuguesa',
    5: 'Geografia',
    6: 'História',
    7: 'Sociologia',
    8: 'Biologia',
    9: 'Física',
    10: 'Matemática',
    11: 'Química',
    13: 'Língua Estrangeira Moderna - Inglês',
    17: 'Ciências',
    11621: 'Educação Financeira',
    5978: 'Filosofia',
    14332: 'Educação Financeira',
    156886: 'Multidisciplinar',
    459708: '90 dias SAEB - Matemática',
    459709: '90 dias SAEB - Língua Portuguesa',
};

// Variáveis globais
let globalAuthToken = null;
let globalNick = null;
let globalExternalId = null;
let currentFetchedTasks = [];
let currentTaskFilterType = '';
let trava = false;

// Função para fazer requisições à API
async function callBackendEndpoint(endpoint, payload) {
    try {
        const response = await fetch(`${PYTHON_SERVER_URL}/${endpoint}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
        });
        
        if (!response.ok) {
            throw new Error(`Erro HTTP ${response.status}`);
        }
        return await response.json();
    } catch (error) {
        console.error(`Erro ao chamar o endpoint ${endpoint}:`, error);
        return { success: false, message: error.message };
    }
}

// Função para exibir notificações
function showNotification(title, message, type = 'info', duration = 3000) {
    const notification = document.createElement('div');
    notification.className = `Notificacao ${type}`;
    
    let icon = '';
    switch (type) {
        case 'success': icon = 'fa-check-circle'; break;
        case 'error': icon = 'fa-exclamation-circle'; break;
        case 'warning': icon = 'fa-exclamation-triangle'; break;
        default: icon = 'fa-info-circle';
    }
    
    notification.innerHTML = `
        <h3><i class="fas ${icon}"></i> ${title}</h3>
        <p>${message}</p>
    `;
    
    const container = document.getElementById('notificationsContainer');
    container.appendChild(notification);
    
    // Animação de entrada
    setTimeout(() => notification.classList.add('show'), 10);
    
    // Remover após a duração especificada
    if (type !== 'processing') {
        setTimeout(() => {
            notification.classList.remove('show');
            notification.classList.add('fadeOut');
            setTimeout(() => notification.remove(), 400);
        }, duration);
    }
    
    return notification;
}

// Função para autenticação
async function login(ra, password) {
    try {
        const response = await callBackendEndpoint('auth', {
            ra: ra,
            password: password
        });
        
        return response;
    } catch (error) {
        return {
            success: false,
            message: 'Erro de conexão com o servidor'
        };
    }
}

// Função para buscar tarefas pendentes
async function getPendingTasks(authToken, nick) {
    try {
        const response = await callBackendEndpoint('tasks/pending', {
            auth_token: authToken,
            nick: nick
        });
        
        return response;
    } catch (error) {
        return {
            success: false,
            message: 'Erro ao buscar tarefas pendentes'
        };
    }
}

// Função para buscar tarefas expiradas
async function getExpiredTasks(authToken, nick) {
    try {
        const response = await callBackendEndpoint('tasks/expired', {
            auth_token: authToken,
            nick: nick
        });
        
        return response;
    } catch (error) {
        return {
            success: false,
            message: 'Erro ao buscar tarefas expiradas'
        };
    }
}

// Função para processar múltiplas tarefas
async function processTasks(authToken, tasks, timeMin, timeMax, isDraft = false) {
    try {
        const response = await callBackendEndpoint('complete', {
            auth_token: authToken,
            tasks: tasks,
            time_min: timeMin,
            time_max: timeMax,
            is_draft: isDraft
        });
        
        return response;
    } catch (error) {
        return {
            success: false,
            message: 'Erro ao processar tarefas'
        };
    }
}

// Função para exibir tarefas no modal de seleção
function displayTasksInSelectionModal(tasks, filterType) {
    const taskListContainer = document.getElementById('taskListContainer');
    const selectAllCheckbox = document.getElementById('selectAllTasksCheckbox');
    
    taskListContainer.innerHTML = '';
    selectAllCheckbox.checked = false;

    if (tasks.length === 0) {
        taskListContainer.innerHTML = '<p style="text-align: center; color: var(--eclipse-text-secondary); padding: 20px;">Nenhuma tarefa encontrada.</p>';
    } else {
        tasks.forEach(task => {
            const listItem = document.createElement('div');
            listItem.className = 'task-list-item';
            
            listItem.innerHTML = `
                <input type="checkbox" id="task-${task.id}" value="${task.id}">
                <label for="task-${task.id}">
                    ${task.title}
                    <span style="color: var(--eclipse-text-secondary); font-size: 0.85em; margin-left: 5px;">
                        (${task.answer_status === 'draft' ? 'Rascunho' : 'Pendente'})
                    </span>
                </label>
            `;
            
            taskListContainer.appendChild(listItem);
        });
    }

    document.getElementById('taskSelectionModalTitle').textContent = 
        filterType === 'pending' ? 'Lições Pendentes' : 'Lições Expiradas';
    
    document.getElementById('taskSelectionModal').style.display = 'flex';
}

// Função principal para login e busca de tarefas
async function loginAndFetchTasks(taskFilter, ra, password) {
    if (trava) return;
    trava = true;

    try {
        showNotification('Autenticação', 'Realizando login...', 'info');
        
        // Fazer login
        const loginResult = await login(ra, password);
        
        if (!loginResult.success) {
            showNotification('Erro', loginResult.message, 'error');
            trava = false;
            return;
        }

        showNotification('Sucesso', 'Login realizado com sucesso!', 'success');
        
        // Buscar tarefas baseado no filtro
        showNotification('Busca', 'Buscando tarefas...', 'info');
        
        let tasksResult;
        if (taskFilter === 'pending') {
            tasksResult = await getPendingTasks(loginResult.user_info.auth_token, loginResult.user_info.nick);
        } else {
            tasksResult = await getExpiredTasks(loginResult.user_info.auth_token, loginResult.user_info.nick);
        }

        if (tasksResult.success) {
            currentFetchedTasks = tasksResult.tasks;
            currentTaskFilterType = taskFilter;
            
            displayTasksInSelectionModal(currentFetchedTasks, taskFilter);
            showNotification('Sucesso', `Encontradas ${tasksResult.count} tarefas`, 'success');
        } else {
            showNotification('Erro', tasksResult.message, 'error');
        }
        
    } catch (error) {
        showNotification('Erro', 'Ocorreu um erro inesperado', 'error');
        console.error('Erro:', error);
    } finally {
        trava = false;
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Toggle de senha
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('senha');
    
    if (togglePassword && passwordInput) {
        togglePassword.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });
    }

    // Botão de tarefas pendentes
    document.getElementById('pendingLessonsBtn').addEventListener('click', function() {
        const ra = document.getElementById('ra').value;
        const password = document.getElementById('senha').value;
        
        if (!ra || !password) {
            showNotification('Atenção', 'Preencha RA e senha', 'warning');
            return;
        }
        
        loginAndFetchTasks('pending', ra, password);
    });

    // Botão de tarefas expiradas
    document.getElementById('expiredLessonsBtn').addEventListener('click', function() {
        const ra = document.getElementById('ra').value;
        const password = document.getElementById('senha').value;
        
        if (!ra || !password) {
            showNotification('Atenção', 'Preencha RA e senha', 'warning');
            return;
        }
        
        loginAndFetchTasks('expired', ra, password);
    });

    // Selecionar todas as tarefas
    document.getElementById('selectAllTasksCheckbox').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#taskListContainer input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });

    // Processar tarefas selecionadas
    document.getElementById('startSelectedTasksBtn').addEventListener('click', async function() {
        const selectedTasks = getSelectedTasks();
        
        if (selectedTasks.length === 0) {
            showNotification('Atenção', 'Selecione pelo menos uma tarefa', 'warning');
            return;
        }
        
        await processSelectedTasks(selectedTasks, false);
    });

    // Processar todas as tarefas
    document.getElementById('startAllTasksBtn').addEventListener('click', async function() {
        await processSelectedTasks(currentFetchedTasks, false);
    });

    // Processar como rascunho
    document.getElementById('startSelectedTasksDraftBtn').addEventListener('click', async function() {
        const selectedTasks = getSelectedTasks();
        
        if (selectedTasks.length === 0) {
            showNotification('Atenção', 'Selecione pelo menos uma tarefa', 'warning');
            return;
        }
        
        await processSelectedTasks(selectedTasks, true);
    });

    // Fechar modal
    document.getElementById('closeTaskSelectionModalBtn').addEventListener('click', function() {
        document.getElementById('taskSelectionModal').style.display = 'none';
    });
});

// Função para obter tarefas selecionadas
function getSelectedTasks() {
    const selectedTasks = [];
    const checkboxes = document.querySelectorAll('#taskListContainer input[type="checkbox"]:checked');
    
    checkboxes.forEach(checkbox => {
        const taskId = checkbox.value;
        const task = currentFetchedTasks.find(t => t.id.toString() === taskId);
        if (task) {
            selectedTasks.push(task);
        }
    });
    
    return selectedTasks;
}

// Função para processar tarefas selecionadas
async function processSelectedTasks(tasks, isDraft) {
    const ra = document.getElementById('ra').value;
    const password = document.getElementById('senha').value;
    const timeMin = parseInt(document.getElementById('modalMinTime').value) || 1;
    const timeMax = parseInt(document.getElementById('modalMaxTime').value) || 3;

    // Fazer login novamente para obter o token
    const loginResult = await login(ra, password);
    
    if (!loginResult.success) {
        showNotification('Erro', 'Falha na autenticação', 'error');
        return;
    }

    // Fechar modal de seleção
    document.getElementById('taskSelectionModal').style.display = 'none';
    
    // Mostrar notificação de processamento
    const processingNotification = showNotification(
        'Processamento', 
        `Processando ${tasks.length} tarefa(s)...`, 
        'processing'
    );

    try {
        // Processar tarefas
        const result = await processTasks(
            loginResult.user_info.auth_token,
            tasks,
            timeMin,
            timeMax,
            isDraft
        );

        // Remover notificação de processamento
        if (processingNotification) {
            processingNotification.classList.remove('show');
            processingNotification.classList.add('fadeOut');
            setTimeout(() => processingNotification.remove(), 400);
        }

        if (result.success) {
            showNotification('Sucesso', result.message, 'success');
            
            // Mostrar resultados detalhados
            result.results.forEach(taskResult => {
                if (taskResult.success) {
                    showNotification('Tarefa Concluída', taskResult.message, 'success', 5000);
                } else {
                    showNotification('Erro na Tarefa', taskResult.message, 'error', 5000);
                }
            });
        } else {
            showNotification('Erro', result.message, 'error');
        }
    } catch (error) {
        showNotification('Erro', 'Falha ao processar tarefas', 'error');
    }
}

// Prevenir envio do formulário
document.getElementById('Enviar').addEventListener('submit', (e) => {
    e.preventDefault();
});
</script>
                       
</body>
</html>
